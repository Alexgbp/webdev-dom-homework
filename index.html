<!DOCTYPE html>
<html>

<head>
  <title>Проект "Комменты"</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <ul class="comments"></ul>
    <div class="add-form">
      <input type="text" class="add-form-name" placeholder="Введите ваше имя" />
      <textarea type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" rows="4"></textarea>
      <div class="add-form-row">
        <button class="add-form-button">Написать</button>
        <button class="add-form-button add-form-button_reset">Удалить коментарий</button>
      </div>
    </div>
  </div>
</body>

<script>
  "use strict";
  const list = document.querySelector(".comments");
  const button = document.querySelector(".add-form-button");
  const addName = document.querySelector(".add-form-name");
  const addText = document.querySelector(".add-form-text");
  let buttonReset = document.querySelector(".add-form-button_reset");

  // Создание масиива с обьектами пользователей который будет рендерится через функцию renderElements()

  let listOfObject = [
    {
      name: "Глеб Фокин",
      data: "12.02.22 12:18",
      comment: "Это будет первый комментарий на этой странице",
      like: 3,
      isLiked: false,
      isEdit: false,
    },
    {
      name: "Варвара Н.",
      data: "13.02.22 19:22",
      comment: "Мне нравится как оформлена эта страница! ❤",
      like: 75,
      isLiked: true,
      isEdit: false,
    },
  ];

  //Сама функция renderElements которая массив обьетов listOfObject рендерит в разметку HTML

  function renderElements() {

    let listOfElements = listOfObject.map((element, index) => {
      return `<li data-index="${index}" class="comment">
        <div class="comment-header">
          <div>${element.name}</div>
          <div>${element.data}</div>
        </div>
        <div class="comment-body">
          ${element.isEdit ? ` <textarea type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" rows="4">${element.comment}</textarea>` : `<div class="comment-text">${element.comment}</div>`}
        </div>
        <div class="comment-footer">
          <div class="likes">
            <span class="likes-counter">${element.like}</span>
            <button data-index="${index}" class="like-button ${element.isLiked ? "-active-like" : ""}"></button> 
          </div>
        </div>
        <button data-index="${index}"class="change-comment-button">${element.isEdit ? "Сохранить" : "Редактировать"}</button>
      </li>`;
    })
      .join("");
    list.innerHTML = listOfElements;
    likeButtons();
    changeComments();
    answerOnCommnets();
  }
  renderElements();

  // Валидация формы на предмет пустых значений в полях имени и текста //

  function validation() {
    if (!addName.value || !addText.value) {
      button.disabled = true;
    } else {
      button.disabled = false;
    }
  }
  addName.addEventListener("input", validation);
  addText.addEventListener("input", validation);

  validation();


  // Обработчик событий на кнопку Отправить.

  function addComment() {
    addText.classList.remove("error");
    addName.classList.remove("error");
    if (!addName.value || !addText.value) {
      addText.classList.add("error");
      addName.classList.add("error");
      return;
    };

    listOfObject.push({
      name: addName.value.replaceAll("<", "&lt;").replaceAll(">", "&gt;"),
      data: new Date().toLocaleString().replace(",", ""),
      comment: addText.value.replaceAll("<", "&lt;").replaceAll(">", "&gt;"),
      like: 0,
      isLiked: false,
      isEdit: false,
    })
    renderElements();
    addName.value = "";
    addText.value = "";

  }

  //Функция добавления коментария с помощью кнопки ENTER //

  function pressEnter(event) {
    if (event.keyCode === 13) {
      addComment()
    }
  }


  button.addEventListener("click", addComment);
  addName.addEventListener("keyup", pressEnter);
  addText.addEventListener("keyup", pressEnter);



  //Функция для проставки лайка

  function likeButtons() {
    let likeButtons = document.querySelectorAll(".like-button");
    for (let likeButton of likeButtons) {
      let index = likeButton.dataset.index;
      let comment = listOfObject[index];
      likeButton.addEventListener("click", (event) => {
        event.stopPropagation();
        if (comment.isLiked) {
          comment.isLiked = false;
          comment.like--;
        } else {
          comment.isLiked = true;
          comment.like++;
        }
        renderElements();
      });
    };
  }




  // Функция для удаления комментария//

  function removeComments() {
    listOfObject.pop();
    renderElements();
  }
  buttonReset.addEventListener("click", removeComments);


  //Функция редактирования комментария


  function changeComments() {
    let changeButtons = document.querySelectorAll(".change-comment-button");
    const addText = document.querySelector(".add-form-text");
    for (let changeButton of changeButtons) {
      changeButton.addEventListener("click", (event) => {
        event.stopPropagation();
        let index = changeButton.dataset.index;
        let comment = listOfObject[index]
        if (comment.isEdit) {
          comment.isEdit = false;
          comment.comment = addText.value;
          comment.data = new Date().toLocaleString().replace(",", "");
        } else {
          comment.isEdit = true;
        }
        renderElements();
      })
    }
  }


  // Функция ответа на комментарий //

  function answerOnCommnets() {
    let commentElements = document.querySelectorAll(".comment")
    for (let commentElement of commentElements) {
      commentElement.addEventListener("click", () => {
        let index = commentElement.dataset.index;
        let comment = listOfObject[index];
        addText.value = `${comment.comment} ${comment.name}`;
        renderElements();
      })
    }
  }

  console.log("It works!");
</script>

</html>




